/*! angular-ztiles (v0.1.1) - Copyright: 2014, Patrick Zimmermann (patrick@knowhere.guru) - MIT */
"use strict";angular.module("pz101.ztiles",[]),angular.module("pz101.ztiles").directive("zTiles",function(a){function b(b,k){function l(a){return a[g]/a[h]}function m(){var a=k.width()-1,c=f;k.find(".z-grid").css("padding","0px").css("margin","0px");for(var g=0;g<d.length;g++)for(var h=d[g],i=(h.na-1)*c,j=(h.nb-1)*c,m=h.c,n=h.ra,o=h.rb,p=(j-i+n*c+(o+n)*((c+i-a)/n-c))/(-o-o/n*m-m),q=(c+i-a)/n-c+(1+m/n)*p,r=-c+p-q,s=m*p,t=k.find(".z-grid-row-"+g),u=0;u<t.length;u++){var v=angular.element(t[u]),w=v.attr("grid-type");if("c"===w)v.css("height",p+"px").css("width",s+"px").css("margin-bottom",c+"px");else if("a"===w){var x=h.offset+h.pa[v.attr("grid-col")],y=b.cards[x];v.css("height",r+"px").css("width",l(y)*r+"px").css("margin-"+h.float,c+"px")}else if("b"===w){var z=h.offset+h.pb[v.attr("grid-col")],A=b.cards[z];v.css("width",l(A)*q+"px").css("margin-top",c+"px").css("margin-bottom",c+"px").css("height",q+"px").css("margin-"+h.float,c+"px")}}b.$evalAsync(function(){e=k.html()})}function n(a,b,c,d){o("c",c,0,a[b.pc],d);for(var e=0;e<b.na;e++)o("a",c,e,a[parseInt(b.pa[e],10)],d);for(var f=0;f<b.nb;f++)o("b",c,f,a[parseInt(b.pb[f],10)],d);d.append('<div class="z-grid-clear" style="clear:both" />')}function o(c,e,f,g,h){var j='<div class="z-grid z-grid-row-'+e+'" grid-col="'+f+'" grid-type="'+c+'" style="float:'+d[e].float+'">'+i+"</div>",k=b.$new(!0);k.card=g,k.mother=b.$parent;var l=a(j)(k);h.append(l)}function p(a,b,c){if(b.length>=3){for(var e=0,f=0;f<b.length;f++)l(b[f])<l(b[e])&&(e=f);for(var g=l(b[e]),h=e,i=[],j=[],k=null,m=0;m<b.length;m++)m!==h&&(null===k&&(k=!0),k?i.push(m):j.push(m),k=!k);for(var o=0,p=0;p<i.length;p++)o+=l(b[i[p]]);for(var q=0,r=0;r<j.length;r++)q+=l(b[j[r]]);var s={c:g,ra:o,rb:q,na:i.length,nb:j.length,pa:i,pb:j,pc:h,offset:c,"float":"left"};d.push(s),n(b,s,d.length-1,a)}}b.widthKey&&(g=b.widthKey),b.heightKey&&(h=b.heightKey),b.cardPadding&&(f=parseInt(b.cardPadding)),b.maxCards&&(j=parseInt(b.maxCards)),k.html()&&(i=k.html(),k.empty()),null!==e&&k.append(e);var q=angular.element(window);q.resize(function(){m()}),k.resize(function(){m()}),b.cards&&(c=b.cards.length),b.$watch("cards",function(){if(b.cards&&c!==b.cards.length){var a=c;for(c=b.cards.length;c>a;){var d=Math.min(j+1,c-a),e=Math.min(d,3);d>3&&(e=Math.floor(Math.random()*(d-3)+3)),p(k,b.cards.slice(a,a+e),a),a+=e}m()}})}var c=0,d=[],e=null,f=4,g="width",h="height",i="",j=5;return{restrict:"A",scope:{cards:"=cards",widthKey:"@",heightKey:"@",cardPadding:"@",maxCards:"@"},link:b}});